<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <script src="js/mui.min.js"></script>
    <script src="js/connectnet.js"></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="css/mui.picker.min.css" />
    <link rel="stylesheet" href="css/mui.poppicker.css" />
    <style type="text/css">
		.div-inline{ display:inline-block;width: 49%;padding: 5px;text-align: center;} 
		/*main-bgColor{background:-webkit-gradient()}*/
		.main-bgImg{
			height: 100%;
			background-image: url(images/back.jpg);
		}
		.div-circle{
			display: inline-block;
			vertical-align: middle;
			width: 80px;
			height: 80px;
			border-radius: 50%;
			border: 2px solid black;
			border-color: rgba(100, 197, 205, 0.2);
			padding: 25px 0px;
			margin-bottom: -10px;
			font-size: 10px;
			background: rgba(255,255,255,0.2);
		}
		
		.big-circle{
			background: lightblue;
			width: 120px;
			height: 120px;
			margin: -10px;
			padding-top: 15px;
		}
		
		.inner-circle{
			background: white;
			display: inline-block;
			vertical-align: middle;
			width: 88px;
			height: 88px;
			border-radius: 50%;
			border: 1px solid blue ;
			border-color: rgba(255, 255, 255, 0.5);
			padding-top: 15px;
		}
		.font-css1{color: #333333;font-size: 30px;}
		.font-css2{color: #333333;font-size: 13px;}
		.font-css3{color: #333333;line-height: 2.5em;font-size: 18px;}
		.font-css4{color: lightcoral;font-size: 18px;}
		
		.font-css5{color: #333333;font-size: 24px;}
		
		.font-css6{line-height: 1em;padding: 5px;font-size: 20px;}
		
		.air-btn .div-circle{margin: 20px 10px;}
		
		.mt30{margin-top: 30px;}
		.mt20{margin-top: 20px;}
		.mt10{margin-top: 10px;}
		
		.ok-btn{border: 1px solid #E3E3E3;padding: 5px auto;background: ;}
			
		.swith-disabled{
			position: absolute;
			width: 100px;
			height: 50px;
			z-index: 0;
			top: 0px;
			right: 20px;
		}
		.p5{
			padding: 5px;
		}
	</style>
	
</head>
<body>

	 <!-- 主界面菜单同时移动 -->
	     <!-- 侧滑导航根容器 -->
	     <div class="mui-off-canvas-wrap mui-draggable">
	         <!-- 主页面容器 -->
	         <div class="mui-inner-wrap">
	             <!-- 菜单容器 -->
	             <aside class="mui-off-canvas-left" id="offCanvasSide">
	                 <div class="mui-scroll-wrapper">
	                     <div class="mui-scroll">
	                         <!-- 菜单具体展示内容 -->
	                         
	                     </div>
	                 </div>
	             </aside>
	             <!-- 主页面标题 -->
	             <header class="mui-bar mui-bar-nav main-bgColor">
	                 <a class="mui-icon mui-action-menu mui-icon-bars mui-pull-left" href="#offCanvasSide"></a>
	                 <h1 class="mui-title">福睿禧环保科技</h1>
	                 <a id="exit" class="mui-action-back mui-icon mui-action-menu mui-icon-close mui-pull-right"></a>
	             </header>
	             <nav class="mui-bar mui-bar-tab main-bgColor">
	     		    <a class="mui-tab-item mui-active">
	     		        <span class="mui-icon mui-icon-home"></span>
	     		        <span class="mui-tab-label">社区</span>
	     		    </a>
	     		    <a class="mui-tab-item">
	     		        <span class="mui-icon mui-icon-phone"></span>
	     		        <span class="mui-tab-label">修报</span>
	     		    </a>
	     		    <a class="mui-tab-item">
	     		        <span class="mui-icon mui-icon-email"></span>
	     		        <span class="mui-tab-label">预设</span>
	     		    </a>
	     		    <a class="mui-tab-item">
	     		        <span class="mui-icon mui-icon-person"></span>
	     		        <span class="mui-tab-label">我</span>
	     		    </a>
	     		</nav>
	             <!-- 主页面内容容器 -->
	    	<div class="mui-content main-bgImg mui-scroll-wrapper ">
	    		<div class="mui-scroll">
	    			<div class="mui-row mt10">
						<div class="mui-col-xs-4 mui-text-center p5">
							状态：<label id="statusLabel">关</label>
						</div>
						
						<div class="mui-col-xs-3 p5">
							<a id='showUserPicker' >选择机器</a>
						</div>
						<div class="mui-col-xs-2 mui-text-center p5">
							开关：
							 
						</div>
						<div class="mui-col-xs-2 mui-switch mui-active" id="switchBtn1">  
        					<div class="mui-switch-handle" ></div>  
    					</div>
    					<!--防止点击切换按钮过快-->
    					<div id="swith-disabled" class="swith-disabled">
    					</div>
					</div>
			    	<div class="mui-row mt20">
			        	<div class="mui-col-xs-6 mui-text-center">
			        		<div class="wd1 div-circle" id="wendu">
			        			<div class="font-css1">16</div>
			        		</div>
			        		<div class="font-css3">温度℃</div>
			        	</div>
				        <div class="mui-col-xs-6 mui-text-center">
				        	<div class="div-circle" id="shidu">
				        		<div class="font-css1">13.8</div>

				        	</div>
				        	<div class="font-css3">设定温度℃</div>
				        </div>
				        <div class="mui-col-xs-12 mui-text-center">
				        	<div class="div-circle big-circle">
				        		<div class="inner-circle" id="pm">
				        			<div class="font-css4">PM2.5指数</div>
					        		<div class="font-css1">34</div>

				        		</div>
				        	</div>
				        </div>
				    </div>
				    <div class="mui-row">
				        <div class="mui-col-xs-6 mui-text-center">
				        	<div class="div-circle" id="eryht">
				        		<div class="font-css1">232</div>

				        	</div>
				        	<div class="font-css3">送风温度℃</div>
				        </div>
				        <div class="mui-col-xs-6 mui-text-center">
				        	<div class="div-circle" id="wuran">
				        		<div class="font-css1">0.76</div>

				        	</div>
				        	<div class="font-css3">PM2.5浓度  μg/m³</div>
				        </div>
			    	</div>
			    	<div class="mui-col-xs-50 mui-text-center">
			    		<img src="images/logo.1.png"/>
			    	</div>
		    	</div>
			</div>
		</div>
	
	<script type="text/javascript" src="js/jquery.min.js" ></script>
	<script type="text/javascript" src="js/req.js" ></script>
	<script type="text/javascript" src="js/mui.picker.js" ></script>
	<script type="text/javascript" src="js/mui.poppicker.js" ></script>
	<script type="text/javascript" src="js/common.js" ></script>
	<script type="text/javascript" charset="utf-8">
		mui('.mui-scroll-wrapper').scroll({
	        deceleration: 0.0005 //flick 减速系数，系数越大，滚动速度越慢，滚动距离越小，默认值0.0006
	    });
      	mui.plusReady(function(){
      		mui.toast("硬件api准备成功！");
    	})
      	
      	var task1;
      	function closeTask1(){
      		task1&&window.clearInterval(task1);
      	}
      	
      	function startTask1(){
			task1 = window.setInterval(function(){
				getAirData();
			},3000);
      	}
      	
      	/**
      	 * 获取空调温度、湿度、PM2.5、二氧化碳、污染数据
      	 */
      	function getAirData(){
      		closeTask1();
      		/* httpReq: req.js中的全局对象 */
      		httpReq.queryAirUnitMsg(function(data){
      			var data = data.MachineMsg;
	      		data = data.replace(/'/g,'"');
	      		data = JSON.parse(data);
      			//判断状态
      			if(data.status == '0'){
      				if($("#switchBtn1").hasClass("mui-active")){
      					mui("#switchBtn1").switch().toggle();
      				}
      				$("#statusLabel").text("关");
      			}else{
      				startTask1();
      				//mui.toast(JSON.stringify(data));
		      		if(!$("#switchBtn1").hasClass("mui-active")){
      					mui("#switchBtn1").switch().toggle();
      				}
		      		$("#statusLabel").text("开");
		      		
		      		var pmval;
		      		if(gParam.currentMachId == 1002||gParam.currentMachId == 1004||gParam.currentMachId == 1005){
		      			pmval = data.pmval/5;
		      		}else{
		      			pmval = data.pmval/3;
		      		}
		      		pmval = pmval.toFixed(1);
		  			setValues(data.weidu,data.shidu,pmval,data.eryht,data.tvoc);
		  			
		  			
		  			//判断字段
		  			var num8 = data.strv1&&data.strv1.substring(7,8);
		  			var num9 = data.strv1&&data.strv1.substring(8,9);
		  			if(num8 == '1'){
		  				mui.toast("送风机过载");
		  			}
		  			if(num9 == '1'){
		  				mui.toast("送风机压差保护");
		  			}
      				
      			}
	  			
	  		});
      	}
      	
      	
      	/**
      	 * 1.2 用户登录 暂时不需要
      	 */
      	/*httpReq.login(function(data){
      		mui.toast(JSON.stringify(data));
      	});*/
      	
      	$(function() {
      		getAirData();
			/**
			 * 获取对象属性的值
			 * 主要用于过滤三级联动中，可能出现的最低级的数据不存在的情况，实际开发中需要注意这一点；
			 * @param {Object} obj 对象
			 * @param {String} param 属性名
			 */
			var _getParam = function(obj, param) {
				return obj[param] || '';
			};
			//普通示例
			var userPicker = new mui.PopPicker();
			userPicker.setData([
				{value: '1001',text: '空调1001'},
				{value: '1002',text: '空调1002'},
				{value: '1003',text: '空调1003'},
				{value: '1004',text: '空调1004'},
				{value: '1005',text: '空调1005'},
				{value: '1006',text: '空调1006'},
				{value: '1007',text: '空调1007'}
			]);
			var showUserPickerButton = document.getElementById('showUserPicker');
			var userResult = document.getElementById('userResult');
			showUserPickerButton.addEventListener('tap', function(event) {
				userPicker.show(function(items) {
					//设置全局参数空调id为当前选中id 
					gParam.currentMachId = items[0].value;
					//弹出选中提示
					mui.toast("已切换至机器" + items[0].text);
					//设置选中机器为当前选择器默认值
					userPicker.pickers[0].setSelectedValue(items[0].value,200);
					//请求空调数据
					getAirData();
					//关闭弹出层 
					return true;
				});
			}, false);
			
			
			document.getElementById("switchBtn1").addEventListener("toggle",function(event){
				closeTask1();
				//挡住按钮
				$(".swith-disabled").css("z-index","1");
				//十秒后放开按钮
				setTimeout(function(){
					//放开按钮
					$(".swith-disabled").css("z-index","0");
				},10000);
				
				var flag = 0;//默认为关
				if(event.detail.isActive){
					console.log("你启动了开关");
					//打开开关
					flag = 1;
					$("#statusLabel").text("开");
				}else{
					console.log("你关闭了开关");
					$("#statusLabel").text("关");
				}
				httpReq.switch(flag,function(){
					if(flag==0){
						setValues(0,0,0,0,0);
					}else{
						getAirData();
					}
				},function(){
					stopBubble(event);
					mui.toast("操作失败！");
				});
			});
			
			$("#swith-disabled").on("tap",function(){
				mui.toast('机器正在处理，请稍后。');
			})
			
		});
		
		function setValues(wendu, sWendu, pm, sfWendu, pmnd){
			$("#wendu .font-css1").text(wendu/10);
			$("#shidu .font-css1").text(sWendu/10);
  			$("#pm .font-css1").text(pm);
  			$("#eryht .font-css1").text(sfWendu/10);
  			$("#wuran .font-css1").text(pmnd/10);
		}
    </script>
</body>
</html>